<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>Taapmaan Cold Chain Logistics - Explore Available Vehicles for Efficient Cold Storage Solutions</title>
        <meta content="width=device-width, initial-scale=1.0" name="viewport" />
        <meta content="Free HTML Templates" name="keywords" />
        <meta content="Free HTML Templates" name="description" />
        <!-- Include your CSS and JavaScript libraries -->
         
        <!-- Favicon -->
        <link href="img/favicon.ico" rel="icon" />

        <!-- Google Web Fonts -->
        <link rel="preconnect" href="https://fonts.gstatic.com" />
        <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;500;600;700&family=Rubik&display=swap" rel="stylesheet" />

        <script>
            fetch('http://localhost:3000/api/get-google-api-key')
                .then(response => response.json())
                .then(data => {
                    const apiKey = data.apiKey;
                    const script = document.createElement('script');
                    script.src = `https://maps.googleapis.com/maps/api/js?key=${apiKey}&libraries=places&callback=initAutocomplete`;
                    script.async = true;
                    script.defer = true;
                    document.head.appendChild(script);
                })
                .catch(error => {
                    console.error("Error fetching API key:", error);
                });
        </script>

        <!-- Font Awesome -->
        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/all.min.css" rel="stylesheet" />

        <!-- Libraries Stylesheet -->
        <link href="lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet" />
        <link href="lib/tempusdominus/css/tempusdominus-bootstrap-4.min.css" rel="stylesheet" />

        <!-- Customized Bootstrap Stylesheet -->
        <link href="css/bootstrap.min.css" rel="stylesheet" />

        <!-- Template Stylesheet -->
        <link href="css/style.css" rel="stylesheet" />
    </head>
    <body>
        <script type="text/javascript">
            var submitted = false;
        </script>
        <iframe
            name="hidden_iframe3"
            id="hidden_iframe3"
            style="display: none"
            onload="if(submitted){
            const success = document.getElementById('success-contact-submit')
            success.innerHTML = 'We have recieved your details. We will contact you soon regarding it. Thankyou!'
    }"
        ></iframe>
        <!-- Topbar Start -->
        <div class="container-fluid py-2 px-lg-5 d-none d-lg-block bg-secondaryblue">
            <div class="row">
                <div class="col-md-6 text-center text-lg-left mb-2 mb-lg-0">
                    <div class="d-inline-flex align-items-center">
                        <a class="text-dark pr-3" href=""><i class="fa fa-phone-alt mr-2"></i>0129 406 5262</a>
                        <span class="text-dark">|</span>
                        <a class="text-dark px-3" href=""><i class="fa fa-envelope mr-2"></i>taapmaanlive@gmail.com</a>
                    </div>
                </div>
                <div class="col-md-6 text-center text-lg-right">
                    <div class="d-inline-flex align-items-center">
                        <a class="text-dark px-3" target="_blank" href="https://wa.me/7303650513?text=Hi!%20I%20am%20interested%20in%20Taapmaan's%20cold%20storage%20and%20logistics%20services.%20Could%20you%20please%20share%20more%20information?%20Thank%20you!">
                            <i class="fab fa-whatsapp"></i>
                        </a>

                        <a class="text-dark px-3" href="https://www.instagram.com/taapmaanlive?igsh=eW85Zmt0cWQ5ejM4&utm_source=qr">
                            <i class="fab fa-instagram"></i>
                        </a>
                        <a class="text-dark pl-3" href="https://www.youtube.com/watch?v=Jz4Wz4BvBFg">
                            <i class="fab fa-youtube"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
        <!-- Topbar End -->

        <!-- Navbar Start -->
        <div class="container-fluid position-relative nav-bar p-0">
            <div class="position-relative" style="z-index: 9">
                <nav class="navbar navbar-expand-lg bg-white shadow navbar-dark py-3 py-lg-0 pl-3 pl-lg-5">
                    <a href="index.html" class="navbar-brand">
                        <img src="img/logo.png" width="180px" />
                    </a>
                    <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbarCollapse">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse justify-content-between px-3" id="navbarCollapse">
                        <div class="navbar-nav ml-auto py-0">
                            <a href="index.html" class="nav-item nav-link active">Home</a>
                            <a href="about.html" class="nav-item nav-link">About</a>
                            <a href="service.html" class="nav-item nav-link">Service</a>
                            <a href="contact.html" class="nav-item nav-link">Contact</a>
                            <a href="login.html" class="nav-item nav-link">Login</a>
                        </div>
                    </div>
                </nav>
            </div>
        </div>
        <!-- Navbar End -->
        <div style="background-color: #edf9ff">
            <div>
                <h2 class="mb-md-4 text-center pt-4 text-secondaryblue">Your One Stop Cold <span class="text-primaryorangehg" style="color: #ffb125">& Hot Chain Solution</span></h2>

                <div class="row mx-md-5 mx-2">
                    <div class="col-lg-3 col-12 userfilled-form bg-white shadow p-3 rounded-lg d-flex align-items-center justify-content-center my-4">
                        <form id="truckFilterForm">
                            <div class="row justify-content-center">
                                <div class="col-6 col-md-4 col-lg-11 d-flex flex-column my-2">
                                    <label>Pickup Location:</label>
                                    <input id="pickup-location" type="text" class="form-control p-3" placeholder="Enter pickup location" readonly />
                                </div>

                                <div class="col-6 col-md-4 col-lg-11 d-flex flex-column my-2">
                                    <label>Drop Location:</label>
                                    <input id="drop-location" type="text" class="form-control p-3" placeholder="Enter drop location" readonly />
                                </div>

                                <div class="col-6 col-md-4 col-lg-11 d-flex flex-column my-2">
                                    <label>Pickup Date:</label>
                                    <input id="pickup-date" type="text" class="form-control p-3 datetimepicker-input" placeholder="Pickup Date" data-target="#date" data-toggle="datetimepicker" readonly />
                                </div>

                                <div class="col-6 col-md-4 col-lg-11 d-flex flex-column my-2">
                                    <label>Vehicle Type:</label>
                                    <input id="selected-vehicle" class="form-control p-2" readonly />
                                </div>

                                <div class="col-6 col-md-4 col-lg-11 d-flex flex-column my-2">
                                    <label>Quantity Of Product:</label>
                                    <input id="quantity-product" class="form-control p-2" readonly />
                                </div>

                                <div class="col-6 col-md-4 col-lg-11 d-flex flex-column my-2">
                                    <label>Type Of Product:</label>
                                    <input id="type-product" class="form-control p-2" readonly />
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="col-lg-9 col-12 all-vehicles">
                        <div id="vehicleResults" class="row justify-content-center mx-0 my-4"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Vehicle Modal -->
        <div class="modal fade" id="vehicleModal" tabindex="-1" aria-labelledby="vehicleModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Confirm your details</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <!-- https://docs.google.com/forms/d/e/1FAIpQLSciUs5rnk0JtcReAfl8jeYXZmk-tINfyioYc-1Z3SVwCbk6kQ/viewform?usp=pp_url&entry.971733700=name&entry.338509281=phone&entry.1178663220=weight&entry.1400587036=price&entry.74539831=pickup&entry.1797661727=drop&entry.860171057=date&entry.1674096571=type+vehicle&entry.495744575=quantity+product&entry.860091518=type+product -->
                        <form action="https://docs.google.com/forms/u/0/d/e/1FAIpQLSciUs5rnk0JtcReAfl8jeYXZmk-tINfyioYc-1Z3SVwCbk6kQ/formResponse" method="post" target="hidden_iframe3" onsubmit="return vehicleModalSubmit()">
                            <div class="row justify-content-center align-items-center">
                                <input id="yourName" name="entry.971733700" type="text" class="col-5 form-control p-3 m-2" placeholder="Name" required />
                                <input id="yourPhonenumber" name="entry.338509281" type="text" class="col-5 form-control p-3 m-2" placeholder="Phone No." required />
                                <input id="exactWeight" name="entry.1178663220" type="text" class="col-8 form-control p-3 m-2" placeholder="Exact Weight" required />Kg
                            </div>
                            <hr />

                            <div class="row mt-3 justify-content-center align-items-center">
                                <p class="col-11"><strong>Vehicle Name:</strong> <span id="modalVehicleName"></span></p>
                                <p class="col-11"><strong>Temperature Range:</strong> <span id="modalTempRange"></span></p>
                                <p class="col-11"><strong>Price:</strong> <span id="modalEstimatedPrice"></span></p>
                                <input id="modal-price" name="entry.1400587036" type="text" class="form-control p-3 m-2 rounded-pill col-11" hidden />
                                <input id="modal-pickup-location" name="entry.74539831" type="text" class="form-control p-3 m-2 rounded-pill col-11" readonly />
                                <input id="modal-drop-location" name="entry.1797661727" type="text" class="form-control p-3 m-2 rounded-pill col-11" readonly />
                                <input id="modal-pickup-date" name="entry.860171057" type="text" class="form-control p-3 m-2 rounded-pill col-11" readonly />
                                <input id="modal-selected-vehicle" name="entry.1674096571" type="text" class="form-control p-3 m-2 rounded-pill col-11" readonly />
                                <input id="modal-quantity-product" name="entry.495744575" type="text" class="form-control p-3 m-2 rounded-pill col-11" readonly />
                                <input id="modal-type-product" name="entry.860091518" type="text" class="form-control p-3 m-2 rounded-pill col-11" readonly />
                            </div>
                            <div class="modal-footer">
                                <p id="success-contact-submit" class="text-center"></p>
                                <button type="submit" class="btn btn-primary">Submit</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer Start -->
        <div class="container-fluid bg-secondaryblue py-5 px-sm-3 px-md-5" style="margin-top: 90px">
            <div class="row pt-5">
                <div class="col-lg-3 col-md-6 mb-5">
                    <h4 class="text-uppercase text-light mb-4">Get In Touch</h4>
                    <p class="mb-2"><i class="fa fa-map-marker-alt text-white mr-3"></i>Sector 16A, SEO 59 lower ground floor</p>
                    <p class="mb-2"><i class="fa fa-phone-alt text-white mr-3"></i>0129 406 5262</p>
                    <p><i class="fa fa-envelope text-white mr-3"></i>taapmaanlive@gmail.com</p>
                    <h6 class="text-uppercase text-white py-2">Follow Us</h6>
                    <div class="d-flex justify-content-start">
                        <a class="text-dark px-3" target="_blank" href="https://wa.me/7303650513?text=Hi!%20I%20am%20interested%20in%20Taapmaan's%20cold%20storage%20and%20logistics%20services.%20Could%20you%20please%20share%20more%20information?%20Thank%20you!">
                            <i class="fab fa-whatsapp"></i>
                        </a>
                        <a class="btn btn-lg btn-dark btn-lg-square mr-2" href="https://www.youtube.com/watch?v=Jz4Wz4BvBFg"><i class="fab fa-youtube"></i></a>
                        <a class="btn btn-lg btn-dark btn-lg-square" href="https://www.instagram.com/taapmaanlive?igsh=eW85Zmt0cWQ5ejM4&utm_source=qr"><i class="fab fa-instagram"></i></a>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6 mb-5">
                    <h4 class="text-uppercase text-light mb-4">Usefull Links</h4>
                    <div class="d-flex flex-column justify-content-start">
                        <a class="text-dark mb-2" href="termsnconditions.html"><i class="fa fa-angle-right text-white mr-2"></i>Term & Conditions</a>
                        <a class="text-dark mb-2" href="privacypolicy.html"><i class="fa fa-angle-right text-white mr-2"></i>Privacy Policy</a>
                        <a class="text-dark mb-2" href="shipmentpolicy.html"><i class="fa fa-angle-right text-white mr-2"></i>Shipment Policy</a>
                        <a class="text-dark mb-2" href="cancellationpolicy.html"><i class="fa fa-angle-right text-white mr-2"></i>Cancellation Policy</a>
                        <a class="text-dark mb-2" href="#"><i class="fa fa-angle-right text-white mr-2"></i>Return & Refund</a>
                        <a class="text-dark" href="#"><i class="fa fa-angle-right text-white mr-2"></i>Help & FQAs</a>
                    </div>
                </div>
            </div>
        </div>
        <div class="container-fluid bg-greyishblue py-4 px-sm-3 px-md-5">
            <p class="mb-2 text-center text-body">&copy; <a href="#">Taapmaan</a>. All Rights Reserved.</p>

            <!--/*** This template is free as long as you keep the footer author’s credit link/attribution link/backlink. If you'd like to use the template without the footer author’s credit link/attribution link/backlink, you can purchase the Credit Removal License from "https://htmlcodex.com/credit-removal". Thank you for your support. ***/-->
            <!-- <p class="m-0 text-center text-body">Designed by <a href="https://htmlcodex.com">ocupy</a></p> -->
        </div>
        <!-- Footer End -->

        <!-- Back to Top -->
        <a href="#" class="btn btn-lg btn-primaryorange btn-lg-square back-to-top"><i class="fa fa-angle-double-up"></i></a>

        <script src="js/main.js"></script>
        <script>
            // Populate fields with data from localStorage
            document.getElementById("pickup-location").value = localStorage.getItem("pickupLocation");
            document.getElementById("drop-location").value = localStorage.getItem("dropLocation");
            document.getElementById("pickup-date").value = localStorage.getItem("pickupDate");
            document.getElementById("selected-vehicle").value = localStorage.getItem("selectedVehicle");
            document.getElementById("quantity-product").value = localStorage.getItem("quantityProduct");
            document.getElementById("type-product").value = localStorage.getItem("typeProduct");

            async function fetchAvailableTrucks() {
                const pickupLocation = document.getElementById("pickup-location").value;
                const dropLocation = document.getElementById("drop-location").value;
                const pickupDate = document.getElementById("pickup-date").value;
                const selectedVehicle = document.getElementById("selected-vehicle").value;
                const quantityProduct = document.getElementById("quantity-product").value;
                const typeProduct = document.getElementById("type-product").value;

                try {
                    const response = await fetch("vehicles.json");
                    const vehicles = await response.json();
                    const vehicleResults = document.getElementById("vehicleResults");
                    vehicleResults.innerHTML = "";

                    vehicles.forEach(async (vehicle, index) => {
                        const vehicleCard = document.createElement("div");
                        vehicleCard.className = "vehicle_box bg-white my-2 p-0 border shadow rounded";

                        const { pricePerKg, estimatedPriceRange } = await calculateEstimatedPrice(vehicle, pickupLocation, dropLocation, quantityProduct);

                        // Store these values in the vehicle object for easy access
                        vehicle.estimatedPriceRange = estimatedPriceRange;
                        vehicle.pricePerKg = pricePerKg;

                        vehicleCard.innerHTML = `
                <div class="bg-${vehicle.vehicleType} d-flex justify-content-between">
                    <h5 class="p-2">${vehicle.vehicleName}</h5>
                    <h5 class="p-2">Runs On: M T W T F S S</h5>
                </div>
                <div class="p-sm-4 p-2 vehicle_info">
                    <p class="vehicle_route"><i class="text-dark fa fa-location-arrow mr-2"></i> ${vehicle.startFrom},${vehicle.dropLocations}</p>
                    <p><i class="text-dark fa fa-archive mr-2"></i> ${vehicle.capacity} Kg (${vehicle.size})</p>
                    <p><i class="text-dark fa fa-thermometer-half mr-2"></i> ${vehicle.vehicleType} (${vehicle.tempRange})</p>
                </div>
                <div class="m-2 px-sm-4 pb-sm-4 px-2 pb-2 pt-0 d-flex justify-content-between align-items-center">
                    <div><p class="estimated_price font-weight-bold result mb-0 bg-${vehicle.vehicleType} rounded-pill px-2 py-1 px-sm-3 py-sm-2">Estimated Price: ${estimatedPriceRange}</p><p class="estimated_price mt-1 px-2 py-1 px-sm-3 py-sm-2">₹ ${pricePerKg} per Kg</p></div>
                    <button type="button" class="btn-booknow rounded-pill px-3 py-2 btn btn-primary" data-target="#vehicleModal" data-index="${index}" onclick="populateVehicleModal()">Book Now</button>
                </div>`;

                        vehicleResults.appendChild(vehicleCard);
                    });

                    // Get references to modal fields
                    const modalVehicleName = document.getElementById("modalVehicleName");
                    const modalTempRange = document.getElementById("modalTempRange");
                    // const modalCapacity = document.getElementById("modalCapacity");
                    const modalEstimatedPrice = document.getElementById("modalEstimatedPrice");
                    const inputField = document.querySelector("#modal-price");

                    // Event delegation to handle "Book Now" clicks
                    vehicleResults.addEventListener("click", (e) => {
                        if (e.target.classList.contains("btn-booknow")) {
                            const vehicleIndex = e.target.getAttribute("data-index");
                            const vehicle = vehicles[vehicleIndex];

                            // Populate modal with vehicle data
                            modalVehicleName.textContent = `${vehicle.vehicleName} (${vehicle.capacity}Kg)`;
                            modalTempRange.textContent = `${vehicle.tempRange}`;
                            // modalCapacity.textContent = `${vehicle.capacity} Kg (${vehicle.size})`;
                            // Populate the modal with the estimated price data
                            modalEstimatedPrice.textContent = "Enter a valid weight";

                            document.getElementById("exactWeight").addEventListener("input", async function (e) {
                                const weight = parseFloat(e.target.value);

                                if (isNaN(weight) || weight <= 0) {
                                    // If invalid weight, show a message or clear the price
                                    modalEstimatedPrice.textContent = "Enter a valid weight";
                                    return;
                                }

                                const { pricePerKg, estimatedPriceRange } = await calculateEstimatedPrice(vehicle, pickupLocation, dropLocation, quantityProduct);
                                modalEstimatedPrice.textContent = `₹ ${pricePerKg * weight} `;
                                inputField.value = modalEstimatedPrice.textContent;
                             
                            });
                        }
                    });
                } catch (error) {
                    console.error("Error fetching vehicles:", error);
                    document.getElementById("vehicleResults").innerHTML = "<p>Unable to fetch vehicle data.</p>";
                }
            }

            fetchAvailableTrucks();
        </script>
        <script>
            function populateVehicleModal() {
                // Get the values from the form
                const pickupLocation = document.getElementById("pickup-location").value;
                const dropLocation = document.getElementById("drop-location").value;
                const pickupDate = document.getElementById("pickup-date").value;
                const selectedProduct = document.getElementById("selected-vehicle").value;
                const productQuantity = document.getElementById("quantity-product").value;
                const productType = document.getElementById("type-product").value;

                // Set the values in the modal
                document.getElementById("modal-pickup-location").value = pickupLocation;
                document.getElementById("modal-drop-location").value = dropLocation;
                document.getElementById("modal-pickup-date").value = pickupDate;
                document.getElementById("modal-selected-vehicle").value = selectedProduct;
                document.getElementById("modal-quantity-product").value = productQuantity;
                document.getElementById("modal-type-product").value = productType;

                // Programmatically open the modal
                $("#vehicleModal").modal("show");
            }

            function vehicleModalSubmit() {
                const yourName = document.getElementById("yourName").value;
                const yourPhonenum = document.getElementById("yourPhonenumber").value;

                if (!yourName || !yourPhonenum) {
                    document.getElementById("success-contact-submit").innerHTML = "Please fill all the details before proceeding!";
                    return;
                }

                submitted = true;
                return true;
            }
        </script>

        <script src="js/priceEstimation.js"></script>

        <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.bundle.min.js"></script>
    </body>
</html>
